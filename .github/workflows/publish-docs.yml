name: Publish Docs

on:
  workflow_dispatch: # Allows manual trigger button
  push:
    branches:
      - master  # Make sure this matches your PRIVATE repo branch name
    paths:
      - 'docs/**'
      - 'docs.json'

jobs:
  publish-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout private repository
        uses: actions/checkout@v4

      - name: Push to public repository
        run: |
          # 1. Setup variables
          PUBLIC_REPO="https://x-access-token:${{ secrets.DOCS_PUSH_TOKEN }}@github.com/attentium/Attentium-Public.git"
          
          # 2. Clone the public repo into a temp folder
          rm -rf /tmp/docs-repo
          git clone $PUBLIC_REPO /tmp/docs-repo
          
          # 3. Clean destination (remove everything except .git)
          cd /tmp/docs-repo
          find . -maxdepth 1 ! -name '.git' ! -name '.' -exec rm -rf {} +
          
          # 4. Copy files from Private Repo (root) to Public Repo (root)
          # We go back to the workspace root ($GITHUB_WORKSPACE) to grab files
          cp -R $GITHUB_WORKSPACE/docs/* .
          cp $GITHUB_WORKSPACE/docs.json .
          
          # 5. Config Git User
          git config user.name "Attentium Bot"
          git config user.email "bot@attentium.xyz"
          
          # 6. FORCE Update the Remote URL (Fixes Error 128)
          git remote set-url origin $PUBLIC_REPO
          
          # 7. Commit and Push
          git add .
          git commit -m "Sync docs from private repo" || echo "No changes to commit"
          
          # Explicitly push to the 'main' branch
          git push origin HEAD:main