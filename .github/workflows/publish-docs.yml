name: Publish Docs

on:
  push:
    branches:
      - master
    paths:
      - 'docs/**'
      - 'mint.json'

jobs:
  publish-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Push docs to public repo
        run: |
          # 1. Setup fresh clone
          rm -rf /tmp/docs-repo
          git clone https://x-access-token:${{ secrets.DOCS_PUSH_TOKEN }}@github.com/blockpal1/Attentium-Public.git /tmp/docs-repo

          # 2. Clear old public docs (Leave .git folder alone)
          rm -rf /tmp/docs-repo/*

          # 3. FLATTEN COPY: Take contents of docs/ and put in root
          # This ensures 'introduction.mdx' ends up at the root level
          cp -R docs/* /tmp/docs-repo/
          
          # 4. Copy config
          cp mint.json /tmp/docs-repo/

          # 5. Commit & Push
          cd /tmp/docs-repo
          git config user.name "docs-bot"
          git config user.email "docs-bot@users.noreply.github.com"

          git add .
          # The '|| echo' prevents failure if there's nothing new to commit
          git commit -m "Update docs from private repo" || echo "No changes to commit"
          git push